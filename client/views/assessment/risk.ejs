<!DOCTYPE html>
<html lang="en">

<head>
  <title>弗明汉心脏风险评估</title>
  <% include ../layout/layout %>
  <link rel="stylesheet" href="<%=_src('/css/assessment/assessment.min.css')%>">
  <script src="<%=_src('/lib/picker/picker.min.js')%>"></script>
</head>
<body>
  <p class="risk-top">弗明汉心脏病研究（Framingham Heart Study）名十年心脏病风险评估，是根据胆固醇水平和非胆固醇因素计算个体未来十年冠心病发作几率的方法。</p>
  <div class="showPicker">1 您的性别
        <span id="showSex"></span>
  </div>
  <div class="showPicker">2 您的年龄
        <span id="showAge"></span>
  </div>
  <div class="showPicker">3 您是否吸烟
        <span id="showSmoke"></span>
  </div>
  <div class="showPicker">4 您的血压
    <span id="showTreatment"></span><span id="showPressure"><a style="color:#999">选择高压</a></span>
  </div>
  <div class="showPicker">5 总胆固醇水平
    <span id="showCholesterol"></span>
  </div>
  <div style="display:inline-flex;border-bottom:1px solid #dcdcdc;" class="showPicker"><div style="width:70%;word-wrap:word-break">6 高密度脂蛋白胆固醇水平</div>
        <span style="width:30%" id="showGoodCholesterol"></span>
  </div>
  <input id="title" type="text" name="title" class="display">
  <div class="account-btn">
      <button type="button" onclick="submit()"  id="riskbtn"  class="weui-btn" >提交</button>
  </div>
   
<script type="text/javascript">  

  var HDL; //高密度脂蛋白
  var TC; //总胆固醇
  var age; //年龄
  var cure; //是否治疗 0否 1是 
  var sex; //性别
  var smoke; //是否吸烟 0否 1是 
  var systolic; //血压

  var showSex = document.getElementById('showSex');
  var showAge = document.getElementById('showAge');
  var showSmoke = document.getElementById('showSmoke');
  var showPressure = document.getElementById('showPressure');
  var showTreatment = document.getElementById('showTreatment');
  var showCholesterol = document.getElementById('showCholesterol');
  var showGoodCholesterol = document.getElementById('showGoodCholesterol');
  
  var dataSex = [{
    text: '男',
    value: 0
  }, {
    text: '女',
    value: 1
  }];
  
  var dataAge = [{
    text: '20-34',
    value: 1
  },{
    text: '35-39',
    value: 2
  },{
    text: '40-44',
    value: 3
  },{
    text: '45-49',
    value: 4
  },{
    text: '50-54',
    value: 5
  },{
    text: '55-59',
    value: 6
  },{
    text: '60-64',
    value: 7
  },{
    text: '65-69',
    value: 8
  },{
    text: '70-74',
    value: 9
  },{
    text: '75-79',
    value: 10
  }];
  
  var dataIsSmoke = [{
    text: '否',
    value:0
  },{
    text: '是',
    value:1
  }];
    
  var dataPressure = [{
    text: '<120',
    value:0
  },{
    text:'120-129',
    value:1
  },{
    text:'130-139',
    value:2
  },{
    text:'140-159',
    value:3
  },{
    text:'160+',
    value:4
  }];
  
  var dataTreatment = [{
    text: '无治疗',
    value:0
  },{
    text: '有治疗',
    value:1
  }];

  var dataCholesterol = [{
    text: '<160',
    value:0
  },{
    text: '160-199',
    value:1
  },{
    text: '200-239',
    value:2
  },{
    text: '240-279',
    value:3
  },{
    text: '≧280',
    value:4
  }];

  var dataGoodCholesterol = [{
    text: '≧60',
    value:0
  },{
    text: '50-59',
    value:1
  },{
    text: '40-49',
    value:2
  },{
    text: '<40',
    value:3
  }];
  
  var pickerSex = new Picker({
    data: [dataSex],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
  var pickerAge = new Picker({
    data: [dataAge],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
  var pickerIsSmoke = new Picker({
    data: [dataIsSmoke],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
  var pickerPressure = new Picker({
    data: [dataPressure],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
    var pickerTreatment = new Picker({
    data: [dataTreatment],
    selectedIndex: [-1],
    title: '您的选择'
  });

  var pickerCholesterol = new Picker({
    data: [dataCholesterol],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
  var pickerGoodCholesterol = new Picker({
    data: [dataGoodCholesterol],
    selectedIndex: [-1],
    title: '您的选择'
  });
  
  function ifFull(){
    if(HDL!=undefined && TC!=undefined  && age!=undefined  && cure!=undefined  && sex!=undefined && smoke!=undefined  && systolic!=undefined){  
        $('#riskbtn').removeAttr('disabled');
        $('#riskbtn').css('background','#35B2F2');
       }
  }
  
  pickerSex.on('picker.select', function(selectedVal, selectedIndex) {
    showSex.innerText = dataSex[selectedIndex[0]].text;
  
    sex = dataSex[selectedIndex].value;
      ifFull();
  });
  
  pickerAge.on('picker.select', function(selectedVal, selectedIndex) {
    showAge.innerText = dataAge[selectedIndex[0]].text;
 
    age = dataAge[selectedIndex].value;
       ifFull();
  });

    pickerIsSmoke.on('picker.select', function(selectedVal, selectedIndex) {
      showSmoke.innerText = dataIsSmoke[selectedIndex[0]].text;
    
      smoke = dataIsSmoke[selectedIndex].value;
         ifFull();
   });
   
   pickerPressure.on('picker.select', function(selectedVal, selectedIndex) {
      showPressure.innerText = dataPressure[selectedIndex[0]].text;
    
      systolic = dataPressure[selectedIndex].value;
        ifFull();
   });
   
     pickerTreatment.on('picker.select', function(selectedVal, selectedIndex) {
      showTreatment.innerText = dataTreatment[selectedIndex[0]].text;
   
      cure = dataTreatment[selectedIndex].value;
         ifFull();
   });
   
   pickerCholesterol.on('picker.select', function(selectedVal, selectedIndex) {
      showCholesterol.innerText = dataCholesterol[selectedIndex[0]].text;
 
      TC = dataCholesterol[selectedIndex].value;
         ifFull();
   });
   
    pickerGoodCholesterol.on('picker.select', function(selectedVal, selectedIndex) {
      showGoodCholesterol.innerText = dataGoodCholesterol[selectedIndex[0]].text;
   
      HDL = dataGoodCholesterol[selectedIndex].value;
          ifFull();
   });
   
  $(document).ready(function() {
     $('#riskbtn').attr('disabled',true);
     $('#riskbtn').css('background','#ccc');
  });
   function submit(){

        var list = {
        "HDL": HDL,
        "TC": TC,
        "age": age,
        "cure": cure,
        "sex": sex,
        "smoke": smoke,
        "systolic": systolic
       }; 
        $.ajax({  
          url: window.location.pathname + "/verify",  
          data: JSON.stringify(list),  
          dataType: "json",  
          type: "POST",  
          contentType : 'application/json',
          success: function (responseJSON) { 
            window.location.href = window.location.pathname + "/risk";
          }  
        });  
      }
    
  showSex.addEventListener('click', function() {
    pickerSex.show();
  });
  
  showAge.addEventListener('click', function() {
    pickerAge.show();
  });
  
  showSmoke.addEventListener('click', function() {
    pickerIsSmoke.show();
  });
  
  showPressure.addEventListener('click', function() {
    pickerPressure.show();
  });
  
  showTreatment.addEventListener('click', function() {
    pickerTreatment.show();
  });
  
  showCholesterol.addEventListener('click', function() {
    pickerCholesterol.show();
  });
  
  showGoodCholesterol.addEventListener('click', function() {
    pickerGoodCholesterol.show();
  }); 
  </script>
</body>

</html>
